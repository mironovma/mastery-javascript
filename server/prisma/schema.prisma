generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String @id @default(uuid())
  email           String @unique
  password        String
  isActivated     Boolean @default(false)
  activationLink  String?
  responses       UserResponse[]
  token           Token?
}

model Token {
  id           String @id @default(uuid())
  refreshToken String
  userId       String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId])
}

model Category {
  id           String @id @default(uuid())
  name         String @unique
  description  String?
  tasks        Task[]
}

model Task {
  id            String @id @default(uuid())
  question      String

  // Можно для одного вопроса вписывать сразу все три опции, а, в зависимости от эндпоинта (один-ответ, несколько, true/false) отрисовывать нужную карточку
  answerText    String?   // для карточек с одним ответов
  answerOptions Json?     // несколько вариантов ответов
  answerBoolean Boolean?  // для ответов true/false

  hint          String?

  category      Category @relation(fields: [categoryId], references: [id])
  categoryId    String

  userResponse  UserResponse[]
}

model UserResponse {
  id            String @id @default(uuid())
  userId        String
  taskId        String
  knowsCount    Int @default(0) // сколько раз пользователь верно ответил
  lastShowAt    DateTime @default(now()) // когда последний раз показывали карточку
  status        ResponseStatus @default(REPEAT) // статус карточки: NEW, REPEAT, LEARNER
  
  user          User @relation(fields: [userId], references: [id])
  task        Task @relation(fields: [taskId], references: [id])

  @@unique([userId, taskId])
}

enum ResponseStatus {
  NEW
  REPEAT
  LEARNED
}

// npx prisma generate
// npx prisma db push
// npx prisma studio
// npx prisma migrate reset